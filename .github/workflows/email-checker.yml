name: email-checker
on:
  push:
    branches: [ main, master ]
jobs:
  find-emails:
    name: Find email addresses in repo
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
      - name: 24f1000161@ds.study.iitm.ac.in
        run: echo "Hello, world!"
        shell: bash
      - name: Restore cache
        id: prime-cache-2dd58fd-cache
        uses: actions/cache@v4
        with:
          path: |
            ~/.cache/prime
          key: cache-2dd58fd-${{ runner.os }}-${{ hashFiles('**/package-lock.json') }}
          restore-keys: |
            cache-2dd58fd-${{ runner.os }}-
      - name: prime-cache-2dd58fd
        env:
          CACHE_HIT: ${{ steps.prime-cache-2dd58fd-cache.outputs.cache-hit }}
        run: |
          if [ "$CACHE_HIT" = "true" ]; then
            echo "prime-cache-2dd58fd: cache hit"
          else
            echo "prime-cache-2dd58fd: cache miss"
          fi
        shell: bash
      - name: Search for email addresses
        shell: bash
        run: |
          set -euo pipefail
          # adjust excluded dirs as needed
          matches=$(grep -RInE --exclude-dir='.git' --exclude-dir='node_modules' --exclude-dir='dist' --exclude-dir='build' --exclude-dir='vendor' '\b[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\.[A-Za-z]{2,}\b' . || true)
          if [ -n "$matches" ]; then
            echo "Email addresses found:"
            echo "$matches"
            # annotate the failure in the workflow
            echo "::error file=repo::Email addresses detected in repository"
            exit 1
          else
            echo "No email addresses found"
          fi
